# Let It Be

–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –∏ –¥–æ–±–∞–≤–∏—Ç—å –µ—â—ë —â–µ–ø–æ—Ç–∫—É –º–∞–≥–∏–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö!

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∞:

```ruby
describe BeatleWeightedSearchQuery do
  let!(:paul) { create(:beatle, name: "Paul") }
  let!(:ringo) { create(:beatle, name: "Ringo") }
  let!(:george) { create(:beatle, name: "George") }
  let!(:john) { create(:beatle, name: "John") }

  specify { expect(subject.call("john")).to contain_exactly(john) }

  # –¥–∞–ª–µ–µ –∏–¥—É—Ç –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã
end
```

–ß—Ç–æ –±—Ä–æ—Å–∞–µ—Ç—Å—è –≤ –≥–ª–∞–∑–∞? –ú—ã —Å–æ–∑–¥–∞—ë–º _–≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω—É—é —á–µ—Ç–≤—ë—Ä–∫—É_ –∑–∞–Ω–æ–≤–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞. –ò —Ö–æ—Ç—è –ë–∏—Ç–ª–∑ –º–Ω–æ–≥–æ –Ω–µ –±—ã–≤–∞–µ—Ç, –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞—à–∏—Ö —Ç–µ—Å—Ç–æ–≤ —ç—Ç–æ —Å–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ.

–ú—ã –º–æ–≥–ª–∏ –±—ã –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è [`before_all`](./before_all.md) –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º–∞ _–ø–æ–≤—Ç–æ—Ä—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö_:

```ruby
describe BeatleWeightedSearchQuery do
  before_all do
    @paul = create(:beatle, name: "Paul")
    # ...
  end

  specify { expect(subject.call("joh")).to contain_exactly(@john) }

  # ...
end
```

–î–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –∏–º–µ–µ—Ç —Ä—è–¥ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–≤ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ _–º–∞–ª–æ–π –∫—Ä–æ–≤—å—é_: –Ω–∞–º –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å `let/let!` –≤—ã—Ä–∞–∂–µ–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ –º–µ—Ç–æ–¥—ã –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–∞.

–° –ø–æ–º–æ—â—å—é `let_it_be` –∂–µ –º—ã –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫:

```ruby
describe BeatleWeightedSearchQuery do
  let_it_be(:paul) { create(:beatle, name: "Paul") }
  let_it_be(:ringo) { create(:beatle, name: "Ringo") }
  let_it_be(:george) { create(:beatle, name: "George") }
  let_it_be(:john) { create(:beatle, name: "John") }

  specify { expect(subject.call("john")).to contain_exactly(john) }

  # –¥–∞–ª–µ–µ –∏–¥—É—Ç –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã
end
```

–ò –≤—Å—ë! –ú–µ–Ω—è–µ–º `let!` –Ω–∞ `let_it_be`. ¬´–ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º¬ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ `before_all`, –Ω–æ _–≤–Ω–µ—à–Ω–∏–π_ API –±–ª–∏–∂–µ –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É API RSpec.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –¥—è–¥—è –ü–∏—Ç–µ—Ä–∞ –ü–∞—Ä–∫–µ—Ä–∞: ¬´–ß–µ–º –±–æ–ª—å—à–µ —Å–∏–ª–∞, —Ç–µ–º –±–æ–ª—å—à–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å¬ª.
–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ [—Ä–∞–∑–¥–µ–ª ¬´–ü—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è¬ª](#–ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è) –¥–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

–í –≤–∞—à–µ–º `rails_helper.rb` –∏–ª–∏ `spec_helper.rb` –¥–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ—á–∫—É:

```ruby
require "test_prof/recipes/rspec/let_it_be"
```

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `let_it_be` –≤ —Ç–µ—Å—Ç–∞—Ö:

```ruby
describe MySuperDryService do
  let_it_be(:user) { create(:user) }

  # ...
end
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: `let_it_be` –Ω–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª Rails, `use_transactional_tests`,(`use_transactional_fixtures` –≤ Rails < 5.1),
–ª–∏–±–æ `use_transactional_fixtures` –∏–∑ `rspec-rails`, –ª–∏–±–æ DatabaseCleaner, –ª–∏–±–æ —Å–≤–æ–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º –∏ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –µ–µ –ø–æ—Å–ª–µ.

## –ü—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–æ –æ–±—ä–µ–∫—Ç—ã - –Ω–µ—Ç

–ï—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏—Ç–µ –æ–±—ä–µ–∫—Ç—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤ –±–ª–æ–∫–µ  `let_it_be`, –≤ –≤–∞—à–µ–º —Ç–µ—Å—Ç–µ, —Ç–æ –≤–∞–º, –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–∏–¥–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –∏—Ö.
–î–ª—è —ç—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã](#–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã).

–°–º. —Ç–∞–∫–∂–µ [–ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è –¥–ª—è `before_all`](./before_all.md#–ø—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è).

## –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã

–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–≤–µ—Ä—à–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞–¥ –æ–±—ä–µ–∫—Ç–∞–º–∏, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–º–∏ —á–µ—Ä–µ–∑ `let_it_be`, –ø–µ—Ä–µ–¥ **–∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º**.
–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Ä–µ—à–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É —É—Ç–µ—á–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏ (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö _–æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è_ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, –Ω–æ Ruby –æ–±—ä–µ–∫—Ç—ã ‚Äî –Ω–µ—Ç).

–î–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã:

```ruby
# –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ reload: true –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—ä–µ–∫—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ ActiveRecord)
let_it_be(:user, reload: true) { create(:user) }

# —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ
before_all { @user = create(:user) }
let(:user) { @user.reload }

# –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä refind: true –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç (–≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö reload –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
let_it_be(:user, refind: true) { create(:user) }

# —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ
before_all { @user = create(:user) }
let(:user) { User.find(@user.id) }
```

**–ü—Ä–∏–º–µ—á–µ–Ω–∏–µ**: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `let_it_be` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ `active_record` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `rails_helper.rb` **–ø–æ—Å–ª–µ** –∑–∞–≥—Ä—É–∑–∫–∏ Rails –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è); –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã `refind` –∏ `reload` –Ω–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã.

–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å –º–∞—Å—Å–∏–≤–∞–º–∏ –æ–±—ä–µ–∫—Ç–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞–Ω–Ω—ã–º–∏ —Å –ø–æ–º–æ—â—å—é `create_list`:

```ruby
let_it_be(:posts, reload: true) { create_list(:post, 3) }

# —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ
before_all { @posts = create_list(:post, 3) }
let(:posts) { @posts.map(&:reload) }
```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã

–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã:

```ruby
# rails_helper.rb
TestProf::LetItBe.configure do |config|
  # –¢–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ `reload`:
  # –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –≤—Ç–æ—Ä–æ–π ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
  config.register_modifier :reload do |record, val|
    # –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ `reload: false`
    next record unless val
    # –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –Ω–µ-ActiveRecord –æ–±—ä–µ–∫—Ç—ã
    next record unless record.is_a?(::ActiveRecord::Base)
    record.reload
  end
end
```

### –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

–í—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è `let_it_be` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

- –≥–ª–æ–±–∞–ª—å–Ω–æ:

```ruby
TestProf::LetItBe.configure do |config|
  config.default_modifiers[:refind] = true
end
```

- –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø —Ç–µ—Å—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–µ–≥–∏:

```ruby
context "with let_it_be reload", let_it_be_modifiers: {reload: true} do
  # ...
end
```

**–ü—Ä–∏–º–µ—á–µ–Ω–∏**: –¢–µ–≥–∏ –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è:

```ruby
TestProf::LetItBe.configure do |config|
  config.default_modifiers[:freeze] = false
end

context "with reload", let_it_be_modifiers: {reload: true} do
  # –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ freeze: false, reload: true

  context "with freeze", let_it_be_modifiers: {freeze: true} do
    # –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ç–æ–ª—å–∫–æ freeze: true (reload: true –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω)
  end
end
```

## –ü—Å–µ–≤–¥–æ–Ω–∏–º—ã (_–∞–ª–∏–∞—Å—ã_)

–ù–µ –≤—Å–µ–º –Ω—Ä–∞–≤–∏—Ç—Å—è –ë–∏—Ç–ª–∑ üòû –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Å–µ–≤–¥–æ–Ω–∏–º –¥–ª—è –º–µ—Ç–æ–¥–∞ `let_it_be` –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ –∏–º—è:

```ruby
# rails_helper.rb
TestProf::LetItBe.configure do |config|
  config.alias_to :–¥–∞_–±—É–¥–µ—Ç_—Ç–∞–∫
end
```

–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø—Å–µ–≤–¥–æ–Ω–∏–º–æ–≤:

```ruby
# rails_helper.rb
TestProf::LetItBe.configure do |config|
  config.alias_to :let_it_be_with_refind, refind: true
end

describe "smth" do
  let_it_be_with_refind(:foo) { Foo.create }

  # refind –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω
  let_it_be_with_refind(:bar, refind: false) { Bar.create }
end
```

## –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É—Ç–µ—á–µ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ò–∑ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `rspec-rails`](https://relishapp.com/rspec/rspec-rails/v/3-9/docs/transactions) –ø—Ä–æ `before(:context)`:

> Even though database updates in each example will be rolled back, the object won't know about those rollbacks so the object and its backing data can easily get out of sync.

–¢–∞–∫ –∫–∞–∫ `let_it_be` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ `before(:context)`, –º—ã –∏–º–µ–µ–º –¥–µ–ª–æ —Å –æ–ø–∏—Å–∞–Ω–Ω–æ–π –≤—ã—à–µ –ø—Ä–æ–±–ª–µ–º–æ–π: –†—É–±–∏-–æ–±—ä–µ–∫—Ç—ã, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ —Ç–µ—Å—Ç–∞—Ö, –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è, —Ç–µ–º —Å–∞–º—ã–º –ø—Ä–∏–≤–æ–¥—è –∫ _—É—Ç–µ—á–∫–∞–º_. –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–¥ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –º–æ–¥–µ–ª–∏, –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ `updated_at`; –∏–ª–∏ –≤ —Å–∞–º–∏—Ö —Ç–µ—Å—Ç–∞—Ö –≤—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω—è—Ç—å –æ–±—ä–µ–∫—Ç—ã –≤ `before` —Ö—É–∫–∞—Ö.

–ü–æ–¥–æ–±–Ω—ã–µ —É—Ç–µ—á–∫–∏ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏ –∏ –≤–Ω–æ—Å—è—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤ —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
–° –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –ø–æ–¥–æ–±–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±—ã–≤–∞–µ—Ç –Ω–µ —Ç–∞–∫-—Ç–æ –ø—Ä–æ—Å—Ç–æ.

–ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä, `freeze`, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Å –ø–æ–º–æ—â—å—é `let_it_be`, –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–º–∏:

```ruby
let_it_be(:user, freeze: true) { create(:user) }

# —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ
before_all { @user = create(:user).freeze }
let(:user) { @user }
```

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ `freeze` –≤–∞—à–∏ —Ç–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç —Å –æ—à–∏–±–∫–æ–π `FrozenError`, —Ç–æ:

- –¥–æ–±–∞–≤—å—Ç–µ `reload: true`/`refind: true`; –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —ç—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—É. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ (`reload`), –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ (`refind`), –ø–æ—ç—Ç–æ–º—É –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–µ–∫–æ–º–º–µ–Ω–¥—É–µ–º –ø—Ä–æ–±–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `reload: true`;
- –ø–µ—Ä–µ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π —Ç–µ—Å—Ç.

–î–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `let_it_be`, –º—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä `freeze` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å–º. –≤—ã—à–µ).
–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–µ–∫—Ç—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–≥–∏ –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤:

```ruby
# spec/spec_helper.rb
RSpec.configure do |config|
  # ...
  config.define_derived_metadata(let_it_be_frost: true) do |metadata|
    metadata[:let_it_be_modifiers] ||= {freeze: true}
  end
end
```
